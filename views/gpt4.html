<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>간단한 리겜</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
    }

    .container {
    display: flex;
    background-color:#FFA07A;
    /* background-image: url(back.png); */
    justify-content: center;
    /* align-items: center; */
    margin: 0 auto;
    overflow: hidden;
    }

    .shapes-container{
      width: 200px;
      height: 1000px;
    }

    .song-button {
      background-color: rgb(255, 0, 0);
      color: #fff;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 5px;
    }


    .shape {
      position: absolute;
      border-left: 40px solid transparent;
      border-right: 40px solid transparent;
      border-bottom: 80px solid #3498db;
      animation-duration: 2s;
      animation-timing-function: ease-in-out;
      animation-fill-mode: forwards;
      opacity: 1;
    }

    @keyframes fallAndRotate {
      0% {
        transform: translateY(1000px) translateX(50px) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(0px) translateX(50px) rotate(360deg);
        border-radius: 50%;
        opacity: 0;
      }
    }

    .centered-div {
    width: 700px;
    height: 1000px;
    background-color:#FF5733;
    color: white;
    text-align: center;
    align-items: center;
    /* line-height: 931px; */
    }

    .scoreSum {
    font-size: 48px;
    font-weight: bold;
    text-align: center;
    margin: 20px;
    padding: 10px;
    background-color: #333;
    color: #fff;
    border-radius: 10px;
    /* box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); */
    }    

    canvas {
      display: block;
    }

    .hidden-canvas {
    display: none;
    }

    .buttons{
      margin: 120px; 
    }

    .buttons.start{
      display: none;  
    }

    .custom-button {
    display: inline-block;
    width: 200px;
    padding: 10px 20px;
    margin-top: 100px;
    margin-bottom: 100px;
    /* background-color: #007bff; */
    color: #fff;
    cursor: pointer;
    border: none;
    /* border-radius: 5px; */
    transition: background-color 0.3s ease;
    }

    .custom-button.checked {
    background-color: #0056b3;
    }



    .hidden {
    display: none;
    }

    .firework {
        position: absolute;
        width: 100px;
        height: 10px;
        border-radius: 20%;
        background-color: #fbff00;
        animation: explode 0.3s ease-out forwards;
        z-index: 1;
    }

    @keyframes explode {
        0% {
            transform: scale(1);
            opacity: 1;
        }
        100% {
            transform: scale(2);
            opacity: 0;
        }
    }


    /* 팝업클레스 */
    .popup-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    }

    .popup {
        background-color: #fff;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        text-align: center;
    }

  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
</head>
<body>
  <!-- 팝업창 -->
  <div class="popup-overlay" style="display: none;">
    <div class="popup">
        <h2>이메일 입력</h2>
        <p>스코어 업로드를 위한 이메일 주소를 입력해주세요:</p>
        <input type="text" id="emailInput" placeholder="you@example.com">
        <button id="submitButton">확인</button>

        <h2>랭킹</h2>
        <div id="table-container" class="login-container">
          <!-- 백엔드에서 생성한 표가 여기에 삽입됩니다. -->
        </div>
    </div>
  </div>

  <div class="container">
    <!-- <div id="shapes-container"></div> -->
    <div id="shapes-container" class="shapes-container"></div>
    <div class="centered-div">
      <!-- <button onclick="startGame()">시작</button> -->
      <div id="score" class="scoreSum">000000</div>
      <div id="firework"></div>
      <canvas id="gameCanvas" class="hidden-canvas" width="700" height="600" ></canvas>
      <!-- 배경음악을 위한 Audio 요소 추가 -->
      <audio id="backgroundMusic" src="internet.mp3" loop></audio>

      <audio id="internet" src="internet.mp3" loop></audio>
      <audio id="beat" src="beat.mp3" loop></audio>
      <audio id="hell" src="hell.mp3" loop></audio>
      <audio id="be" src="be.mp3" loop></audio>
      <audio id="Ink" src="inkoming.mp3" loop></audio>
      <audio id="Goobbye" src="Goodbye.mp3" loop></audio>

      <div id = "buttons" class="buttons">
        <div>
          <div style="display: block;">
            <button class="song-button" onclick="InkSong()">인커밍</button>
            <button class="song-button" onclick="HellSong()">헬테이커</button>
            <button class="song-button" onclick="wave_goobbye()">wave goobbye</button>
          </div>
          <label for="file-input" class="custom-file-button">
            <img src="add_button.png" alt="File Icon" width="200" height="73">
          </label>
          <input type="file" class="custom-button" id="file-input" style="display: none;">
          <div class="selected-file-name" id="selected-file-name"></div>
        </div>
        <div>
          <div id="start" class="custom-button">
            <img src="start_button.png" alt="Button Image" width="200" height="73">
          </div>
        </div>
      </div>
      <div>
        <div style="background-color: red; margin-bottom: 10px;" id="ggo" class="custom-button">커스텀하러가기</div>
      </div>
      <div>
        <div style="margin-top: 10px; margin-bottom: 10px;" id = "D720" class="custom-button">720</div>
        <div style="margin-top: 10px; margin-bottom: 10px;" id = "D620" class="custom-button">620</div>
        <div style="margin-top: 10px; margin-bottom: 10px;" id = "D520" class="custom-button">520</div>
        <div style="margin-top: 10px; margin-bottom: 10px;" id = "D420" class="custom-button">420</div>
        <div style="margin-top: 10px; margin-bottom: 10px;" id = "D320" class="custom-button">320</div>
      </div>
    </div>
    <div class="shapes-container"></div>
  </div>
</body>


  <script>
    //딜레이변수
    var delay = 850;


    const shapesContainer = document.getElementById('shapes-container');
    //배경효과컬러리스트
    const colorLi = ['#FFD1DC', '#A2FFB5', '#E0B0FF', '#AEDFF7'];
    var colorLiSn = 0;

    // 시계 업데이트 함수
    var startTime = Date.now();
    var elapsedTime = 0;
    var esss1 = -1;
    var esss1_li = [-1,-1,-1,-1,-1,-1];

    var IMusic = 'Ink';
    var dis = 4;


    const start = document.getElementById('start');
    const end = document.getElementById('end');
    
    //배경이미지
    var b_img1 = new Image();
    var b_img2 = new Image();
    var b_img3 = new Image();
    var b_img4 = new Image();
    var b_img5 = new Image();

    var dance_basic1 = new Image();
    var dance_basic2 = new Image();
    var dance_basic3 = new Image();
    var dance_basic4 = new Image();
    var dance_basic5 = new Image();


    var dance_basic1_k = new Image();
    var dance_basic2_k = new Image();
    var dance_basic3_k = new Image();
    var dance_basic4_k = new Image();
    var dance_basic5_k = new Image();
    var dance_basic6_k = new Image();
    var dance_basic7_k = new Image();
    var dance_basic8_k = new Image();


    //아직
    // var dance_left1 = new Image();
    // var dance_left2 = new Image();
    // var dance_left3 = new Image();
    // var dance_left4 = new Image();
    // var dance_left5 = new Image();

    // var dance_right1 = new Image();
    // var dance_right2 = new Image();
    // var dance_right3 = new Image();
    // var dance_right4 = new Image();
    // var dance_right5 = new Image();
    
    b_img1.src = 'dance/dance1.png';
    b_img2.src = 'dance/dance2.png';
    b_img3.src = 'dance/dance3.png';
    b_img4.src = 'dance/dance4.png';
    b_img5.src = 'dance/dance5.png';

    dance_basic1.src = 'dance/danceB1.png';
    dance_basic2.src = 'dance/danceB2.png';
    dance_basic3.src = 'dance/danceB3.png';
    dance_basic4.src = 'dance/danceB4.png';
    dance_basic5.src = 'dance/danceB2.png';

    dance_basic1_k.src = 'dance/k_1.png';
    dance_basic2_k.src = 'dance/k_2.png';
    dance_basic3_k.src = 'dance/k_3.png';
    dance_basic4_k.src = 'dance/k_4.png';
    dance_basic5_k.src = 'dance/k_5.png';
    dance_basic6_k.src = 'dance/k_6.png';
    dance_basic7_k.src = 'dance/k_7.png';
    dance_basic8_k.src = 'dance/k_8.png';

    
    const danceB = [dance_basic1, dance_basic2, dance_basic3, dance_basic4, dance_basic5];

    // Audio 객체 생성
    const tickSound = new Audio();
    const chatSound = new Audio();
    const crapSound = new Audio();

    // 리소스 설정
    tickSound.src = "TickSound.mp3";
    chatSound.src = "chatSound.mp3";
    crapSound.src = "Crap.mp3";

    const arr_sound = []

    for(let i = 0; i < 10; i++){
      const sound = new Audio();
      sound.src = "Crap.mp3";
      arr_sound.push(sound);
    }

    //뒤 이미지
    var bl = new Image();
    bl.src = 'dance/badk2.png';


    //틀 이미지
    var tl = new Image();
    tl.src = 'dance/tl2.png';

    //키이벤트 이미지
    var keyevimg = new Image();
    keyevimg.src = 'dance/keyev.png';

    //상태(state)이미지
    var state_img = new Image();
    
    // 캔버스 요소 가져오기
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    var keyev = {
      x: canvas.width / 7 - 50,
      y: 50,
      width: 100,
      height: 450,
      frame: 5,
      bool: false,
      draw(x){
        ctx.drawImage(keyevimg,x,this.y);
      }
    }

    var background = {
    x : 0,
    y : 0,
    width : 800,
    height : 600,
    img : b_img3,
    draw(){
        ctx.fillStyle = 'green';
        ctx.fillRect(this.x,this.y,this.width,this.height);
        ctx.drawImage(this.img,0,0);
      }
    }

    var state = {
    x : canvas.width/2-85 ,
    y : 0 ,
    width : 100,
    height : 50,
    draw(score){
        if ( score > 500){
          state_img.src = 'dance/cool.png';
          ctx.drawImage(state_img,this.x,this.y);
        }else if (400 < score && score < 500){
          state_img.src = 'dance/good.png';
          ctx.drawImage(state_img,this.x,this.y);
        }else if (11 < score && score < 400){
          state_img.src = 'dance/bad.png';
          ctx.drawImage(state_img,this.x,this.y);
        }
      }
    }

    // 플레이어 객체 생성
    const player = {
      x: canvas.width / 7 - 50,
      y: 550,
      width: 30,
      height: 30,
      color: 'blue',
      speed: 5,
    };

    const bar = {
      x: 0,
      y: 410,
      width: canvas.width,
      height: 10,
      color: 'green',
      draw(){
        ctx.fillStyle = this.color;
        ctx.fillRect(this.x,this.y,this.width,this.height);
      }
    };

    // 상대 플레이어 객체 생성
    const pPlayer = {
      x: canvas.width / 7 - 50,
      y: 50,
      width: 30,
      height: 30,
      color: 'red',
      speed: 5,
    };

    //첫번째에 767추가 2727-767 = 1960 거기에 + 50
    var shootingIntervals_Ink= [6030,6062,6202,6231,6341,6401,6771,6800,6950,6960,7111,7140,12200,12710,13080,13410,13751,14101,14430,14730,15060,15390,15749,16100,16441,16791,17110,17480,17820,18140,18490,18840,19180,19509,19831,20190,20510,20831,21180,21550,21850,22240,22570,22939,23281,23660,23990,24331,24689,25039,25410,25719,26061,26420,26750,27110,27431,27789,28150,28520,28830,29190,29511,29860,30221,30590,30920,31230,31840,32029,32180,32360,32720,32759,32921,32939,33291,33310,33619,33630,34489,34610,34730,34870,35151,35261,35420,35590,35890,36010,36150,36300,36450,36601,37280,37390,37520,37661,37951,38070,38219,38380,38690,38810,38961,39089,39220,39360,40001,40120,40260,40420,40570,40739,40910,41080,41211,41400,41570,41730,41850,42061,42870,42870,43039,43050,43220,43220,43380,43400,43551,43580,43951,43951,44110,44140,44460,44470,44631,44650,44951,44981,45520,45630,45781,45890,46170,46280,46469,46620,46950,47060,47190,47300,47389,47530,48180,48281,48430,48530,48890,49000,49172,49270,49611,49720,49870,49980,50069,50289,51030,51149,51310,51420,51571,51730,51869,52019,52161,52320,52481,52622,52750,53022,53809,53809,53980,53990,54160,54170,54339,54360,54490,54530,54920,54920,55070,55089,55410,55420,55589,55589,55920,55930,56660,56940,57320,57651,57960,58300,58621,58989,59290,59631,59970,60310,60669,61011,61319,61720,62059,62419,62759,63110,63440,63789,64100,64419,64869,65020,65210,65381,65590,65730,65891,66050,66220,67620,67931,68259,68600,68951,69271,69599,69900,70241,70609,70950,71290,71640,71940,72279,72610,72960,73300,73639,73949,74289,74689,74980,75390,75870,76010,76150,76310,76650,76760,76849,76990,78511,78619,78790,78800,79380,79489,79640,79750,81249,81359,81499,81600,82129,82250,82401,82440,83919,84060,84179,84310,84819,84951,85120,85190,86809,87101,87459,87790,88089,88431,88820,89129,89500,89819,90151,90500,90870,91231,91570,91870,92210,92521,92900,93220,93540,93889,94210,94541,94910,95279,95570,95929,96319,96680,97010,97339,97670,97980,98340,98700,99049,99410,99710,100049,100400,100739,101079,101440,101759,102160,102449,102790,103099,103489,103910,104251,104580,104930,105159,105539,105940,106281,106611,106900,107259,107290,107610,107631,108490,108620,108771,108901,109170,109310,109489,109610,109930,110050,110209,110359,110520,110650,111290,111399,111559,111669,111969,112100,112271,112409,112710,112850,112999,113120,113249,113410,114079,114169,114341,114479,114620,114799,114981,115131,115320,115470,115650,115801,115989,116139,116970,116979,117129,117150,117301,117329,117489,117520,117659,117700,118029,118050,118210,118219,118560,118569,118739,118739,119050,119061,119620,119699,119860,119939,120231,120329,120490,120539,120980,121090,121260,121350,121610,121750,122360,122459,122610,122699,122959,123080,123231,123250,123739,123829,124019,124019,124230,124320,125220,125339,125539,125650,125800,125931,126070,126240,126361,126549,126689,126839,127010,127180,127259,127930,127930,128100,128100,128270,128292,128440,128460,128609,128640,128989,128999,129150,129160,129500,129500,129660,129669,130019,130019,130720,130980,131289,131650,132001,132320,132631,132911,133270,133600,133951,134319,134660,135050,135400,135780,136161,136500,136801,137151,137489,137850,138139,138489,138799,139011,139181,139299,139680,139801,139939,140080,141671,141899,142280,142611,142951,143320,143661,143950,144311,144659,144999,145349,145689,146039,146410,146770,147170,147460,147789,148151,148439,148799,149070,149410,149699,149839,149989,150080,150649,150739,150901,151020,152530,152671,152829,152920,153401,153520,153671,153780,155261,155389,155510,155620,156129,156251,156389,156481,157951,158100,158230,158329,158869,158950,159160,159180,160870,161170,161539,161889,162270,162580,162971,163239,163611,163889,164239,164541,164921,165280,165571,165939];
    var shootingIntervals_Hel = [1711,1711,3350,3362,4950,4960,6521,6530,8100,8120,9680,9710,11330,11691,12100,12520,13430,14141,14880,15691,16512,17330,18130,18861,19711,20510,21311,22121,22871,23641,24530,25320,26050,26862,27681,28490,29320,30153,30901,31700,32520,33350,34170,34940,35710,36470,37300,38111,38562,38730,38911,39081,39290,39511,40090,40461,40881,41270,41711,42111,42501,42930,43330,43351,43720,43720,44130,44153,44530,44562,44911,45311,45800,46150,46480,46911,47262,47680,48061,48482,48911,49320,49720,50100,50520,50951,51310,51730,52081,52471,52851,53250,53611,54061,54481,54841,55231,55661,55990,56401,56710,56850,56982,57170,57330,57560,57801,58161,58561,58911,59291,59671,60060,60451,60841,61271,61740,62071,62461,62862,63211,63660,64110,64510,64960,65361,65711,66090,66491,66881,67250,67661,68060,68431,68820,69271,69670,70072,70450,70461,71241,71250,72060,72060,72941,72950,73700,73710,74500,74500,75281,75281,76070,76070,76870,76890,77620,77641,78440,78462,79251,79272,80060,80060,80831,80831,81631,81652,82500,82551,83301,83681,84111,84511,84871,85271,85681,86100,86490,86900,87300,87672,88090,88490,88900,89320,89689,90079,90510,90870,91291,91650,92059,92490,92879,93309,93699,94089,94491,94699,94909,95090,95299,95529,95700,95900,96509,96680,96890,97279,98130,98300,98500,98920,99730,99880,100090,100490,101329,101489,101690,102120,102929,103090,103299,103720,104500,104670,104859,105339,106109,106270,106500,106930,107720,107879,108080,108460,109289,109299,109479,109499,109689,109720,110089,110130,110890,110899,111089,111089,111300,111300,111689,111709,112471,112490,112659,112709,112889,112900,113300,113300,114039,114099,114280,114320,114479,114510,114710,114720,114910,114929,115070,115100,115560,116399,117309,118120,118940,119780,120559,121331,122161,122910,123700,124509,125329,126141,126929,126949,127320,127329,127680,127720,128109,128491,128909,129330,129740,130160,130549,130931,131329,131699,132109,132520,132950,133290,133730,134100,134539,134909,135281,135699,136099,136479,136890,137310,137729,138129,138500,138909,139289,139680,140870,140880,140910,140910,141291,141291,141309,141309,142539,142539,142549,142559,142900,142910,142910,142919,144090,144099,144109,144109,144469,144481,144500,144500,145640,145640,145650,145660,146091,146099,146120,146150,146470,146590,146839,147039,147330,147330,147710,147729,148120,148129,148510,148531,148951,148951,149330,149342,149740,149761,150150,150150,150530,150541,150931,150940,151350,151361,151740,151740,152130,152140,152451,152521,152920,152940,153321,153351,153710,153931,154160,154410,154590,154821,154980,155210,155360,155560,155721,155900,156160,156170,156170,156170,156170,156170,156560,156570,156570,156570,156570,156570,156960,157150,157361,157580,157760,157990,158140,158400,158560,158770,158960,159171,159371,159380,159390,159390,159400,159410,159761,159761,159761,159761,159761,159770,160161,160340,160550,160770,160970,161190,161360,161610,161770,161990,162190,162340,162561,162971,163350,163480,163761,163971,164180,164360,164550,164751,165191,165591,166040,166480,166910,167290,167690,168081,168480,168900,169321,169741,170121,170520,170931,171330,171710,172130,172500,172900,173290,173651,174090,174520,174891,175331,175730,176080,176500,176940,177361,177730,178120,178540,178951,179310,179740,180220,180571,180930,181310,181701,182120,182530,182930,183330,183730,184140,184540,184930,185321,185741,186130,186560,186960,187340,187741,188100,188520,188890,189301,189701,190130,190530,190760,190961,191141,191460,191530,191771,191971,192230,192570,192911,193290,193650,194040,194460,194870,195262,195640,196060,196431,196851,197230,197660,198091,198490,198840,199281,199660,200070,200420,200881,201320,201662,202060,202441,202860,203321,203571,203721,203930,204140,204350,204550,204760,205350,205361,205521,205540,205751,205751,206140,206140,206910,206920,207100,207120,207320,207320,207731,207731,208511,208511,208681,208710,208931,208941,209320,209331,210111,210111,210291,210301,210480,210511,210910,210910,211671,211682,211861,211870,212061,212081,212481,212491,213300,213310,213481,213511,213701,213730,214111,214122,214891,214901,215071,215091,215291,215300,215712,215720,216470,216481,216641,216670,216870,216890,217270,217291,218111,218291,218501,218910,219711,219891,220141,220530,221291,221441,221691,222110,222861,223020,223261,223670,224201,224540,224901,225111,225320,225501,225751,225770];
    var shootingIntervals_Bye= [4840,4840,4851,4851,8881,8894,8894,8894,12681,12691,12701,12711,16511,16511,16520,16530,20391,20771,21251,21721,22171,22660,23111,23601,24071,24531,25001,25450,25950,26460,26931,27391,27791,28321,28821,29291,29741,30231,30730,31250,31682,32171,32661,33131,33621,34101,34551,35051,35500,36011,36471,36951,37422,37900,38361,38821,39262,39731,40200,40691,41142,41651,42141,42661,43111,43601,44071,44520,44951,45411,45901,46391,46850,47281,47800,48241,48741,49341,49541,49831,50031,50281,50331,50811,50811,53721,54611,56781,56811,57392,57392,58401,58421,58421,58430,62232,62240,62240,62250,64382,64401,65000,65011,65541,65550,66041,66482,66941,67412,67871,68361,68832,69311,69740,70241,70741,71232,71670,72181,72661,73140,73631,74131,74631,75110,75530,76020,76491,76960,77460,77941,78401,78820,79342,79810,80280,80760,81260,81770,82220,82661,83150,83642,84120,84590,85051,85511,85981,86451,86901,87411,87870,88361,88820,89341,89782,90260,90720,91211,91681,92151,92580,93091,93581,94070,94531,95040,95291,95540,95790,95891,96520,96530,97201,97210,97492,97501,98362,98370,99111,99141,99381,99412,100300,100321,101050,101060,101340,101340,102240,102240,102871,102891,103170,103170,103700,103940,104161,104632,105082,105540,106041,106501,106981,107510,107981,108001,108430,108440,108840,108860,109320,109340,109830,109840,109840,109850,111260,111451,111740,111751,112210,112231,112700,112710,113161,113161,113640,113650,114130,114130,114610,114631,115090,115111,115600,115630,116061,116061,116520,116520,116971,116980,117440,117450,117910,117910,118380,118380,118861,118891,119360,119390,119831,119851,120310,120330,120780,120801,121270,121270,121761,121761,122221,122221,122701,122710,123202,123212,123681,123711,124171,124171,124670,124670,125120,125140,125581,125591,126041,126052,126500,126500,126971,126990,127451,127471,127930,127930,128421,128421,128861,128870,129351,129381,129841,129860,130331,130341,130821,130831,131281,131281,131750,131750,132211,132222,132700,132700,133170,133181,133651,133680,134590,135101,135601,136051,136490,136930,137440,138060,138450,138890,139370,139840,140351,140840,141340,141340,141370,141390,141461,141802,141802,141811,141830,142251,142260,142260,142260,142730,142740,142740,142740,143210,143210,143230,143240,143680,143680,143690,143690,144151,144151,144151,144151,144600,144610,144610,144620,145111,145111,145111,145111,145611,145620,145631,145640,146101,146112,146112,146112,146540,146551,146551,146551,147011,147011,147011,147020,147470,147470,147480,147480,147940,147950,147950,147950,148410,148410,148410,148420,148881,148881,148891,148891,149330,149330,149371,149371,149870,150390,150830,151290,151750,152220,152670,153150,153590,154150,154600,155120,155551,155790,156011,156261,156510,156690,156971,157200,157420,157941,158431,158881,159361,159840,160350,160781,161260,161711,162181,162670,163161,163630,164110,164590,165070,165531,166011,166501,166971,167431,167911,168390,168881,169370,169861,170370,170820,171340,171560,171850,172740,172761,173221,173230,173701,173710,174180,174180,174630,174640,175080,175090,175540,175550,176260,176290,176720,176731,177300,177321,177900,177930,178411,178411,178881,178911,179371,179371,180350,181250,182151,183081,184010,184910,185970,186250,186500,186680,186960,187210,187450,187701,188031,188921,189841,190800,191719,192640,193590,194530,195520,196459,197340,198300,199250,200230,201169,202149,203210,203210,205099,205120,206999,207020,208861,208871,210959,210969,212690,212699,214639,214660,216450,216459,216470,216480,218379,219381,220331,221240,222289,223159,224099,224590,225069,225571,226051,226269,226559,226751,227029,227261,227469,227719,227960,228239,228469,228689,228919,229189,229419,229639,229849,230130,230361,230640,230840,231109,231330,231519,231769,231990,232220,232511,232750,232950,233179,233369,233639,233659,235649,237490,239189,241249,243150,243159,245069,245080,246979,247010,248869,248889,249299,249529,249750,249970,250189,250459,250769,251301,251801,252240,252712,253190,253690,254100,254562,255031,255490,256020,256470,256951,257440,257921,258410,258890,259360,259830,260280,260770,261231,261750,262210,262720,263180,263650,264160,264650,265101,265590,266061,266521,267001,267450,267940,268400,268920,269390,269821,270321,270801,271270,271771,272271,272690,273181,273641,274110,274590,275091,275560,276041,276491,276960,277480,277480,277491,277491,278171,278191,278201,278460,278460,278460,278460,279051,279430,279611,279871,280101,280341,280580,280830,281030,281351,281831,282310,282791,283221,283731,284180,284691,285130,285560,286010,286551,287021,287492,287930,288441,288901,289351,289841,290350,290791,291301,291712,292231,292680,293191,293731,294191,294641,295071,295341,295581,296481,296511,296971,296971,297491,297491,297981,297991,298451,298481,298901,298921,299361,299371,299851,299871,300331,300791,301071,301410,302110,302430,302721,302951,303160,303471,304160,304160,307871,307901,307910,307910,311730,311741,311741,311741,315410,315410,315430,315430,319360,319380,319411,319420,319420,319420]
    var shootingIntervals = shootingIntervals_Hel;
    var shootingIntervals_2 = [[],[],[],[],[],[]];
    var shootingX_Ink = [50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,450,150,450,150,450,150,450,150,450,150,450,150,450,150,450,150,450,150,450,150,450,150,450,150,450,50,550,150,450,150,450,50,550,50,550,50,550,150,450,50,550,150,450,50,550,150,450,50,550,50,550,150,450,50,550,150,450,50,550,150,450,50,550,50,550,150,450,50,550,150,450,50,550,150,450,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,150,450,50,550,150,450,50,550,150,450,50,550,50,550,150,450,50,550,150,450,50,550,150,450,50,550,50,550,150,450,50,550,150,450,50,550,150,450,50,550,550,50,50,550,50,550,50,550,50,550,50,550,50,550,550,50,550,50,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,150,450,50,550,150,450,50,550,150,450,50,550,150,450,50,550,150,450,50,550,450,150,50,550,150,450,50,550,150,450,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,150,450,150,450,150,450,150,450,150,450,150,450,150,450,150,450,150,450,150,450,150,450,150,450,150,450,150,450,50,550,50,550,50,550,150,450,50,550,150,450,50,550,150,450,50,550,50,550,150,450,50,550,150,450,50,550,150,450,50,550,50,550,150,450,50,550,150,450,50,550,150,450,50,550,550,50,50,550,50,550,50,550,50,550,50,550,50,550,550,50,50,550,50,550,50,550,150,450,50,550,150,450,50,550,150,450,50,550,50,550,150,450,50,550,150,450,50,550,150,450,50,550,50,550,150,450,50,550,150,450,50,550,150,450,50,550,50,550,50,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,150,450,150,450,150,450,150,450,50,550,150,450,50,550,150,450,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,150,450,150,450,150,450,150,450,50,550,150,450,50,550,150,450,50,550,150,450,50,550,150,450,50,550,150,450,50,550,150,450,50,550,150,450,50,550,150,450,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550];
    var shootingX_Hel = [50,550,50,550,50,550,550,50,550,50,50,550,50,550,50,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,550,50,550,50,550,50,550,50,550,50,550,150,450,250,350,50,550,150,450,250,350,150,450,250,350,50,550,50,550,50,550,50,550,250,550,250,550,250,550,250,550,50,450,50,450,50,450,50,450,250,550,250,550,250,550,250,550,50,350,50,350,50,350,50,550,150,450,250,350,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,150,450,150,450,150,450,150,450,150,450,150,450,150,450,150,450,50,550,550,50,50,550,50,550,450,150,150,450,450,150,150,450,250,350,250,350,250,350,250,350,150,450,450,150,450,150,150,450,50,550,50,550,50,550,50,550,150,450,150,450,150,450,150,450,50,550,50,550,50,550,50,550,150,450,150,450,50,550,150,450,250,350,150,450,50,50,50,50,550,550,550,550,50,50,50,50,550,550,550,550,450,450,450,450,450,450,450,450,150,150,150,150,150,150,150,150,150,450,450,150,450,150,150,450,150,450,450,150,450,150,150,450,150,450,150,450,450,150,450,150,250,350,250,350,250,350,250,350,350,250,250,350,50,550,50,550,50,550,50,550,50,550,50,550,50,550,150,450,150,450,150,450,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,250,350,550,50,250,350,550,50,250,350,550,50,250,350,550,50,250,350,550,50,250,350,550,50,250,550,350,50,250,350,550,50,550,150,450,50,550,50,550,550,50,50,550,550,50,50,550,550,50,50,550,550,50,550,50,50,550,50,550,550,50,50,550,50,550,50,550,550,50,550,50,550,50,550,50,550,50,550,550,550,50,350,450,150,250,550,50,350,450,150,250,550,50,550,50,550,50,550,50,550,50,550,550,50,250,550,450,350,150,550,50,150,250,350,450,550,50,550,50,550,50,550,50,550,50,550,50,550,550,50,550,150,450,250,350,150,450,50,550,50,550,50,550,50,550,50,550,50,450,150,450,150,450,150,450,150,350,250,350,250,350,250,350,250,150,450,150,450,150,450,150,450,50,550,150,450,50,550,150,450,50,550,150,450,50,550,150,450,50,550,150,450,50,550,150,450,50,550,150,450,250,350,150,450,50,550,150,450,150,450,150,450,150,450,150,450,50,550,50,550,50,550,50,550,150,450,150,450,150,450,150,450,50,550,50,550,150,450,250,350,150,450,50,550,150,450,150,450,450,150,150,450,150,450,150,450,150,450,450,150,150,450,150,450,150,450,450,150,150,450,150,450,150,450,450,150,150,450,150,450,150,450,150,450,150,450,150,450,150,450,450,150,150,450,150,450,150,450,150,450,150,450,150,450,150,450,150,450,550,550,550,550,550,550,550,550,50,50,50,50,50,50,50,50,50,550,150,450,250,350,150,450];
    var shootingX_Bye = [350,550,50,250,50,250,350,550,50,250,550,350,50,550,250,350,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,150,450,150,450,150,450,150,450,150,450,150,450,150,450,150,450,250,350,250,350,250,350,250,350,250,350,250,350,250,350,250,350,150,450,150,450,150,450,150,450,150,450,150,450,150,450,150,450,150,50,550,150,450,50,550,50,550,50,550,50,250,350,550,50,250,350,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,150,450,150,450,150,450,150,450,50,550,50,550,50,550,50,550,150,450,150,450,150,450,150,450,50,550,150,450,50,550,150,450,50,550,150,450,50,550,150,450,50,550,150,450,50,550,150,450,50,550,150,450,50,550,150,450,50,550,450,150,150,450,450,150,150,450,150,450,450,150,150,450,550,50,50,550,150,450,50,550,550,50,50,550,150,450,150,450,150,450,150,450,50,550,550,50,150,450,50,550,50,350,550,250,50,550,150,450,450,150,150,450,150,450,450,150,150,450,150,450,450,150,50,550,50,550,550,50,50,550,550,50,50,550,550,50,550,50,150,450,150,450,150,450,150,450,150,450,150,450,450,150,150,450,250,350,250,350,150,450,450,150,250,350,250,350,150,450,450,150,50,550,50,550,550,50,50,550,550,50,550,50,550,50,550,50,50,550,550,50,50,550,50,550,50,550,550,50,550,50,50,550,50,550,50,550,50,550,50,550,50,550,50,550,550,50,450,150,550,550,450,50,150,550,50,150,450,550,50,150,450,550,450,150,50,50,150,450,550,50,150,450,550,150,50,450,550,50,150,450,550,150,50,450,550,50,350,550,250,50,550,250,350,50,550,250,350,50,250,550,350,550,50,250,350,50,250,550,350,50,550,350,250,50,250,550,350,50,550,150,450,50,550,150,450,250,350,150,450,50,550,150,450,250,350,150,450,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,150,450,50,550,150,450,50,550,50,550,50,550,50,550,550,50,50,550,550,50,550,50,250,350,250,350,250,350,250,350,150,450,150,450,150,450,50,550,50,550,50,550,50,550,150,450,250,350,150,450,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,150,450,50,550,250,350,150,450,50,550,550,50,550,50,50,550,350,250,50,550,50,550,50,550,50,550,50,550,150,450,150,450,150,450,150,450,150,450,150,450,150,450,150,450,50,550,50,550,50,550,50,550,150,450,50,550,150,450,250,350,150,450,50,550,50,550,50,550,50,550,50,550,50,550,150,450,250,350,150,450,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,50,550,150,450,50,550,150,450,50,550,150,450,50,550,150,450,50,550,150,450,50,550,150,450,50,550,150,450,50,550,50,150,550,450,450,150,50,150,50,450,550,150,450,50,550,150,450,250,350,150,50,50,550,550,50,50,550,550,50,50,550,550,50,50,550,550,50,50,550,550,50,50,550,550,50,550,150,450,50,550,150,450,50,550,50,550,550,50,50,550,50,550,50,550,550,50,50,550,50,550,150,450,50,550,150,450,50,550,50,550,50,550,250,350,50,350,250,550,50,550,350,250,50,250,350,550,150,450]
    var shootingX = shootingX_Hel;
    var shootingSn_Ink = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435,436,437,438,439,440,441,442,443,444,445,446,447,448,449,450,451,452,453,454,455,456,457,458,459,460,461,462,463,464,465,466,467,468,469,470,471,472,473,474,475,476,477,478,479,480,481,482,483,484,485,486,487,488,489,490,491,492,493,494,495,496,497,498,499,500,501,502,503,504,505,506,507,508,509,510,511,512,513,514,515,516,517,518,519,520,521,522,523,524,525,526,527,528,529,530,531,532,533,534,535,536,537,538,539,540,541,542,543,544,545,546,547,548,549,550,551,552,553,554,555,556,557,558,559,560,561,562,563,564,565,566,567,568,569,570,571,572,573,574,575,576,577,578,579,580,581,582,583,584,585,586];
    var shootingSn_Hel = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435,436,437,438,439,440,441,442,443,444,445,446,447,448,449,450,451,452,453,454,455,456,457,458,459,460,461,462,463,464,465,466,467,468,469,470,471,472,473,474,475,476,477,478,479,480,481,482,483,484,485,486,487,488,489,490,491,492,493,494,495,496,497,498,499,500,501,502,503,504,505,506,507,508,509,510,511,512,513,514,515,516,517,518,519,520,521,522,523,524,525,526,527,528,529,530,531,532,533,534,535,536,537,538,539,540,541,542,543,544,545,546,547,548,549,550,551,552,553,554,555,556,557,558,559,560,561,562,563,564,565,566,567,568,569,570,571,572,573,574,575,576,577,578,579,580,581,582,583,584,585,586,587,588,589,590,591,592,593,594,595,596,597,598,599,600,601,602,603,604,605,606,607,608,609,610,611,612,613,614,615,616,617,618,619,620,621,622,623,624,625,626,627,628,629,630,631,632,633,634,635,636,637,638,639,640,641,642,643,644,645,646,647,648,649,650,651,652,653,654,655,656,657];
    var shootingSn_Bye = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435,436,437,438,439,440,441,442,443,444,445,446,447,448,449,450,451,452,453,454,455,456,457,458,459,460,461,462,463,464,465,466,467,468,469,470,471,472,473,474,475,476,477,478,479,480,481,482,483,484,485,486,487,488,489,490,491,492,493,494,495,496,497,498,499,500,501,502,503,504,505,506,507,508,509,510,511,512,513,514,515,516,517,518,519,520,521,522,523,524,525,526,527,528,529,530,531,532,533,534,535,536,537,538,539,540,541,542,543,544,545,546,547,548,549,550,551,552,553,554,555,556,557,558,559,560,561,562,563,564,565,566,567,568,569,570,571,572,573,574,575,576,577,578,579,580,581,582,583,584,585,586,587,588,589,590,591,592,593,594,595,596,597,598,599,600,601,602,603,604,605,606,607,608,609,610,611,612,613,614,615,616,617,618,619,620,621,622,623,624,625,626,627,628,629,630,631,632,633,634,635,636,637,638,639,640,641,642,643,644,645,646,647,648,649,650,651,652,653,654,655,656,657,658,659,660,661,662,663,664,665,666,667,668,669,670,671,672,673,674,675,676,677,678,679,680,681,682,683,684,685,686,687,688,689,690,691,692,693,694,695,696,697,698,699,700,701,702,703,704,705,706,707,708,709,710,711,712,713,714,715,716,717,718,719,720,721,722,723,724,725,726,727,728,729,730,731,732,733,734,735,736,737,738,739,740,741,742,743,744]
    var shootingSn = shootingSn_Hel;
    var shootingSn_2 = [[],[],[],[],[],[]];
    let shootingIndex = 0;
    var shootingIndex_li = [0,0,0,0,0,0];
    

    //노트찍을때만
    let lastShootMinute = 0;
    let lastShootSecond = 0;
    let lastShootSsecond = 0;

    // 총알 배열
    const bullets = [];
  
    // 상대 총알 배열
    const p_bullets = [];
 

    // 노트 배열
    const note = [];
    const noteX = []

    //score
    var score = 0
    var scoreSum = 0;

    // 키보드 입력 처리
    const keys = {};
    window.addEventListener('keydown', (e) =>{
      // keys[e.code] = true;
      if (e.code === 'KeyA') {
          player.x = 50;
          playerShoot();
          // background.img = b_img1;
          // danceList = danceR;
        }
        if (e.code === 'KeyS') {
          player.x = 150;
          playerShoot();
          // background.img = b_img2;
          // danceList = danceR;
        }
        if (e.code === 'KeyD') {
          player.x = 250;
          playerShoot();
          // background.img = b_img3;
          // danceList = danceB;
        }
        if (e.code === 'KeyJ') {
          player.x = 350;
          playerShoot();
          // background.img = b_img3;
          // danceList = danceB;
        }
        if (e.code === 'KeyK') {
          player.x = 450;
          playerShoot();
          // background.img = b_img4;
          // danceList = danceL;
        }
        if (e.code === 'KeyL') {
          player.x = 550;
          playerShoot();
          // background.img = b_img5;
          // danceList = danceL;
        }
    } );


     //사운드생성
     function beatSound(audio) {
      audio.play();
    }

    // 총알 생성 함수
    function createBullet(x, y) {
      bullets.push({ x, y, width: 100, height: 10, color:'#5F5AFF', speed: 50 });
    }

     // 상대 총알 생성 함수
     function createPBullet(x, y, time) {
      p_bullets.push({ x, y, width: 100, height: 10, color: '#5F5AFF', speed: 10, time});
    }

    function playerShoot() {
      for(let i = 0; i < arr_sound.length; i++){
                  if(arr_sound[i].paused){ // 재생중이 아닌 Audio객체를 찾아서
                    arr_sound[i].play(); // 1회만 재생하고
                    break; // 반복문을 나간다.
                  }
          }
      const bulletX = player.x; // 총알 가운데 위치
      const bulletY = player.y;
      createBullet(bulletX, bulletY);
    }

     // 상대플레이어 발사 처리
     function pPlayerShoot(i) {
      const bulletX = 50+(i*100)
     
      const bulletY = pPlayer.y;
      createPBullet(bulletX, bulletY, shootingIntervals[shootingIndex]);
     
    }

    //시간에 맞추기
    function pPlayerShootTime(i){
      setTimeout(() => {
          esss1_li[i] = shootingSn_2[i][shootingIndex_li[i]];
          pPlayerShoot(i);
          if(colorLiSn > 2){
              colorLiSn = 0
          }else{
              colorLiSn = colorLiSn +1;
            }        
          createTriangle((shootingX[shootingIndex]/2)+80,colorLi[colorLiSn])
          shootingIndex_li[i] = shootingIndex_li[i]+1;
      })
    }

    function Movebullet(bullet,i){
          bullet.y += bullet.speed;
          ctx.fillStyle = bullet.color;
          ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);

          // 총알이 화면 밖으로 나가면 배열에서 제거
          if (bullet.y > 600) {
            p_bullets.splice(i, 1);
            score = 15;
          }
    }

    function MatchBar(j){
      setTimeout(() => {
        for (let i = bullets.length - 1; i >= 0; i--) {
          if(300 < p_bullets[j].y){
            if( bullets[i].y <  p_bullets[j].y && bullets[i].x == p_bullets[j].x){
              score = p_bullets[j].y;
              fireworkEvent(p_bullets[j].x,p_bullets[j].y);
              if(400 < score && score < 500){
                scoreSum = scoreSum + 100;
              }else if(500 < score){
                scoreSum = scoreSum + 200;
                    // beatSound(tickSound);
              }
              // bullets.splice(i, 1);
              bullets.splice(i, 1);
              p_bullets.splice(j, 1);
              break;
            }
          }
        }
      })
    }

    //배경트라이앵글 만들기
    function createTriangle(leftPosition,backgroundColor) {
      setTimeout(() => {
        const triangle = document.createElement('div');
        const triangle_Sub = document.createElement('div');
        const triangle_2 = document.createElement('div');
        const triangle_2Sub = document.createElement('div');

        triangle.classList.add('shape');
        triangle_Sub.classList.add('shape');
        triangle_2.classList.add('shape');
        triangle_2Sub.classList.add('shape');

        shapesContainer.appendChild(triangle);
        shapesContainer.appendChild(triangle_2);
        shapesContainer.appendChild(triangle_Sub);
        shapesContainer.appendChild(triangle_2Sub);

        triangle.style.animationName = 'fallAndRotate';
        triangle.style.left = shapesContainer.offsetLeft + 'px';
        triangle.style.borderColor = backgroundColor;

        triangle_Sub.style.animationName = 'fallAndRotate';
        triangle_Sub.style.top = 100 + 'px';
        triangle_Sub.style.left = (shapesContainer.offsetLeft+50) + 'px';
        triangle_Sub.style.borderColor = '#FFB6C1';

        triangle_2.style.animationName = 'fallAndRotate';
        triangle_2.style.left = shapesContainer.offsetLeft+920 + 'px';
        triangle_2.style.borderColor = backgroundColor;

        triangle_2Sub.style.animationName = 'fallAndRotate';
        triangle_2Sub.style.top = 100 + 'px';
        triangle_2Sub.style.left = shapesContainer.offsetLeft+870 + 'px';
        triangle_2Sub.style.borderColor = '#FFB6C1';

        setTimeout(() => {
            // timeLiSn = timeLiSn + 1;
          triangle.remove();
          triangle_2.remove();
          triangle_2Sub.remove();
        }, 2000); // 애니메이션 시간과 동일한 시간 이후에 요소를 삭제
      })
    }

    //타이머업데이트
    function updateTimer() {
      // setTimeout(() => {
        // 시작 시간을 밀리초로 설정
        const currentTime = Date.now();
        elapsedTime = currentTime - startTime;
    
        const scoreElement = document.getElementById("score");
        scoreElement.textContent = `${scoreSum.toString().padStart(6, '0')}`;
      // })
    }


    // 게임 루프
    function gameLoop() {
      updateTimer();
      
      //console.log('넘어감?');

      // 이전 프레임 지우기
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      //배경준비
      // background.draw();

      ctx.drawImage(bl,0,0);
      //bar.draw();


      //시간맞추기함수
      for(let i = 5; i >= 0; i--){
        if(esss1_li[i] != shootingSn_2[i][shootingIndex_li[i]] && elapsedTime > shootingIntervals_2[i][shootingIndex_li[i]] - delay){
          pPlayerShootTime(i);
        }
      }
    
      //상대총알 이동 및 그리기
      for (let i = p_bullets.length - 1; i >= 0; i--) {
        Movebullet(p_bullets[i],i);
      }


      //내가 쏜 총알 그리기
      for (let i = bullets.length - 1; i >= 0; i--) {
        bullets[i].y -= bullets[i].speed;
        keyev.draw(bullets[i].x);
        // 총알이 화면 밖으로 나가면 배열에서 제거
        if (bullets[i].y < 0) {
          bullets.splice(i, 1);
            score = 15;
          }
      }

      for (let j = p_bullets.length - 1; j >= 0; j--){
        MatchBar(j);
      }

        ctx.drawImage(tl,0,0);
        state.draw(score);

      // 게임 루프 반복
      requestAnimationFrame(gameLoop);
    }


    start.addEventListener('click', (event) => {
      if(shootingIntervals_2[0] == ''){
        alert('노래 선택해주세요~')
        return
      }
      var Hcanvas = document.getElementById("gameCanvas");
      var buttons = document.getElementById("buttons");
      Hcanvas.classList.toggle("hidden-canvas"); // 클래스 토글
      buttons.classList.toggle("start");

      console.log('startclick');
      const backgroundMusic = document.getElementById(IMusic);
      backgroundMusic.loop = false; 
      backgroundMusic.play();

      // 10밀리초마다 시계 업데이트
      startTime = Date.now();


      backgroundMusic.addEventListener("ended", () => {
        alert('끝낫습니다~~');
        backgroundMusic.pause();
        backgroundMusic.currentTime = 0;
        
        playedScorePop();
      });
      // pPlayerShoot();
      console.log('게임시작');
      gameLoop();
      }
    );


    document.getElementById('file-input').addEventListener('change', function (event) {
      const selectedFileName = document.getElementById("selected-file-name");
      var file = event.target.files[0]; // 선택된 파일

      // 파일 이름 표시
      selectedFileName.textContent = file.name;

      var reader = new FileReader();
      reader.onload = function (e) {
        var data = e.target.result;

        // 엑셀 파일을 읽어서 리스트로 변환
        var workbook = XLSX.read(data, { type: 'binary' });
        var sheetName = workbook.SheetNames[0];
        var sheetNameX = workbook.SheetNames[1];
        var sheetNameSn = workbook.SheetNames[2];
        var sheetNameM = workbook.SheetNames[3]
        var sheet = workbook.Sheets[sheetName];
        var sheetX = workbook.Sheets[sheetNameX];
        var sheetSn = workbook.Sheets[sheetNameSn];
        var sheetM = workbook.Sheets[sheetNameM];
        var jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
        var jsonDataX = XLSX.utils.sheet_to_json(sheetX, { header: 1 });
        var jsonDataSn = XLSX.utils.sheet_to_json(sheetSn, { header: 1 });
        var jsonDataM = XLSX.utils.sheet_to_json(sheetM, { header: 1 });

        jsonData[0].splice(0, 1);
        jsonData[0][0] = jsonData[0][0];
        // jsonData[0].push(50000);

        jsonDataX[0].splice(0, 1);
        // jsonDataX[0].push(50000);

        shootingIntervals = jsonData[0];
        shootingX = jsonDataX[0];
        shootingSn = jsonDataSn[0];
        IMusic = jsonDataM[0][0];

        shootingIntervals_2 = [[],[],[],[],[],[]];
        shootingSn_2 = [[],[],[],[],[],[]];

        console.log(shootingIntervals);
        console.log(shootingX);
        console.log(shootingSn);

        for(let i = 0; i < shootingIntervals.length; i++){
        if(shootingX[i] == 50){
          shootingIntervals_2[0].push(shootingIntervals[i]);
          shootingSn_2[0].push(shootingSn[i]);
        }
        if(shootingX[i] == 150){
          shootingIntervals_2[1].push(shootingIntervals[i]);
          shootingSn_2[1].push(shootingSn[i]);
        }
        if(shootingX[i] == 250){
          shootingIntervals_2[2].push(shootingIntervals[i]);
          shootingSn_2[2].push(shootingSn[i]);
        }
        if(shootingX[i] == 350){
          shootingIntervals_2[3].push(shootingIntervals[i]);
          shootingSn_2[3].push(shootingSn[i]);
        }
        if(shootingX[i] == 450){
          shootingIntervals_2[4].push(shootingIntervals[i]);
          shootingSn_2[4].push(shootingSn[i]);
        }
        if(shootingX[i] == 550){
          shootingIntervals_2[5].push(shootingIntervals[i]);
          shootingSn_2[5].push(shootingSn[i]);
        }
      }
      console.log(shootingIntervals_2);
    };

    console.log();

    reader.readAsBinaryString(file); // 파일을 이진 문자열로 읽어옴
  });


  document.getElementById('ggo').addEventListener("click", function() {
      // 이동할 URL 설정
      const targetURL = "https://helpful-sable-16ccb5.netlify.app/gpt";
      // URL로 이동
      window.location.href = targetURL;
    });




  document.getElementById('D720').addEventListener('click', function() {
    const divs = document.querySelectorAll(".checked");
    divs.forEach(div => {
        div.classList.remove("checked");
    });
    delay = 720;
    document.getElementById('D720').classList.toggle("checked");
  // 여기에 원하는 동작을 추가할 수 있습니다.
  });

  document.getElementById('D620').addEventListener('click', function() {
    const divs = document.querySelectorAll(".checked");
    divs.forEach(div => {
        div.classList.remove("checked");
    });
    delay = 620;
    document.getElementById('D620').classList.toggle("checked");
  // 여기에 원하는 동작을 추가할 수 있습니다.
  });

  document.getElementById('D520').addEventListener('click', function() {
    const divs = document.querySelectorAll(".checked");
    divs.forEach(div => {
        div.classList.remove("checked");
    });
    delay = 520;
    document.getElementById('D520').classList.toggle("checked");
  // 여기에 원하는 동작을 추가할 수 있습니다.
  });

  document.getElementById('D420').addEventListener('click', function() {
    const divs = document.querySelectorAll(".checked");
    divs.forEach(div => {
        div.classList.remove("checked");
    });
    delay = 420;
    document.getElementById('D420').classList.toggle("checked");
  // 여기에 원하는 동작을 추가할 수 있습니다.
  });

  function fireworkEvent(x,y) {
    setTimeout(() => {
      console.log(x)
      const FCanvas = document.getElementById("gameCanvas"); // 요소를 가져오거나 선택합니다.
      const CanvasRect = FCanvas.getBoundingClientRect();
      const firework = document.getElementById("firework");

      const fire = document.createElement('div');
      fire.classList.add('firework');
      firework.appendChild(fire);
      
      fire.style.left = CanvasRect.left + x + "px";
      fire.style.top = CanvasRect.top + y  + "px";

      setTimeout(() => {
          // timeLiSn = timeLiSn + 1;
          fire.remove();
        }, 2000); // 애니메이션 시간과 동일한 시간 이후에 요소를 삭제
      })
  }
  
  function InkSong(){
    shootingIntervals = shootingIntervals_Ink;
    console.log(shootingIntervals);
    shootingX = shootingX_Ink;
    shootingSn = shootingSn_Ink;
    IMusic = 'Ink';

    for(let i = 0; i < shootingIntervals.length; i++){
      if(shootingX[i] == 50){
        shootingIntervals_2[0].push(shootingIntervals[i]);
        shootingSn_2[0].push(shootingSn[i]);
      }
      if(shootingX[i] == 150){
        shootingIntervals_2[1].push(shootingIntervals[i]);
        shootingSn_2[1].push(shootingSn[i]);
      }
      if(shootingX[i] == 250){
        shootingIntervals_2[2].push(shootingIntervals[i]);
        shootingSn_2[2].push(shootingSn[i]);
      }
      if(shootingX[i] == 350){
        shootingIntervals_2[3].push(shootingIntervals[i]);
        shootingSn_2[3].push(shootingSn[i]);
      }
      if(shootingX[i] == 450){
        shootingIntervals_2[4].push(shootingIntervals[i]);
        shootingSn_2[4].push(shootingSn[i]);
      }
      if(shootingX[i] == 550){
        shootingIntervals_2[5].push(shootingIntervals[i]);
        shootingSn_2[5].push(shootingSn[i]);
      }
    }
  }
  
  function HellSong(){
    shootingIntervals = shootingIntervals_Hel;
    console.log(shootingIntervals);
    shootingX = shootingX_Hel;
    shootingSn = shootingSn_Hel;
    IMusic = 'hell';
    bl.src = 'dance/badk3.png';

    for(let i = 0; i < shootingIntervals.length; i++){
      if(shootingX[i] == 50){
        shootingIntervals_2[0].push(shootingIntervals[i]);
        shootingSn_2[0].push(shootingSn[i]);
      }
      if(shootingX[i] == 150){
        shootingIntervals_2[1].push(shootingIntervals[i]);
        shootingSn_2[1].push(shootingSn[i]);
      }
      if(shootingX[i] == 250){
        shootingIntervals_2[2].push(shootingIntervals[i]);
        shootingSn_2[2].push(shootingSn[i]);
      }
      if(shootingX[i] == 350){
        shootingIntervals_2[3].push(shootingIntervals[i]);
        shootingSn_2[3].push(shootingSn[i]);
      }
      if(shootingX[i] == 450){
        shootingIntervals_2[4].push(shootingIntervals[i]);
        shootingSn_2[4].push(shootingSn[i]);
      }
      if(shootingX[i] == 550){
        shootingIntervals_2[5].push(shootingIntervals[i]);
        shootingSn_2[5].push(shootingSn[i]);
      }
    }
  }

  function wave_goobbye(){
    shootingIntervals = shootingIntervals_Bye;
    console.log(shootingIntervals);
    shootingX = shootingX_Bye;
    shootingSn = shootingSn_Bye;
    IMusic = 'Goobbye';
    bl.src = 'dance/badk4.png';

    for(let i = 0; i < shootingIntervals.length; i++){
      if(shootingX[i] == 50){
        shootingIntervals_2[0].push(shootingIntervals[i]);
        shootingSn_2[0].push(shootingSn[i]);
      }
      if(shootingX[i] == 150){
        shootingIntervals_2[1].push(shootingIntervals[i]);
        shootingSn_2[1].push(shootingSn[i]);
      }
      if(shootingX[i] == 250){
        shootingIntervals_2[2].push(shootingIntervals[i]);
        shootingSn_2[2].push(shootingSn[i]);
      }
      if(shootingX[i] == 350){
        shootingIntervals_2[3].push(shootingIntervals[i]);
        shootingSn_2[3].push(shootingSn[i]);
      }
      if(shootingX[i] == 450){
        shootingIntervals_2[4].push(shootingIntervals[i]);
        shootingSn_2[4].push(shootingSn[i]);
      }
      if(shootingX[i] == 550){
        shootingIntervals_2[5].push(shootingIntervals[i]);
        shootingSn_2[5].push(shootingSn[i]);
      }
    }
  }

  function playedScorePop(){
    const popupOverlay = document.querySelector(".popup-overlay");
    const emailInput = document.getElementById("emailInput");
    const submitButton = document.getElementById("submitButton");

    popupOverlay.style.display = "flex";

    submitButton.addEventListener("click", function() {
    const enteredEmail = emailInput.value;
    const playMusic = IMusic;
    const playedScore = scoreSum;
    alert("입력한 이메일: " + enteredEmail);
    const jsonData = JSON.stringify({enteredEmail,playMusic,playedScore});
    //fetch('http://localhost:3000/test', {
    fetch('https://port-0-node-express-eu1k2lllm51c76.sel3.cloudtype.app/test', {
                method: 'POST',
                headers: {
                'Content-Type': 'application/json'
                },
                body: jsonData
    })
    .then(response => {
                if (!response.ok) {
                throw new Error('API 요청이 실패했습니다.'); // 에러 핸들링
                }
                return response.json(); // JSON 형태의 응답을 파싱
            })
    .then(data => {
            console.log(data);
        })
    .catch(error => {
          alert('데이터 삽입 오류:'+error);
        });
      popupOverlay.style.display = "none";
    })


    fetch('https://port-0-node-express-eu1k2lllm51c76.sel3.cloudtype.app/e/selectGameScore') // '/query' 엔드포인트를 호출
    .then(response => response.text())
    .then(data => {
      document.getElementById('table-container').innerHTML = data;
    })
    .catch(error => {
      console.error('데이터 가져오기 오류:', error);
    });
  }


  </script>
</html>